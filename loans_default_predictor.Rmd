---
title: "Predictive Modelling for Loans"
output: html_notebook
---
```{r}
library('readxl')
library('tidyverse')
library('janitor')
library('GGally')
```

```{r}
library(readr)
lending_club_loans <- read_csv("C:/Users/44792/OneDrive/Desktop/Codeclan 2022/final_project_loan_default_predictor/data/lending_club_loans.csv")
View(lending_club_loans)
```

```{r}
view(lending_club_loans)
lending_club_loans <- clean_names(lending_club_loans)

```
```{r}
loans1 <- lending_club_loans %>%
  select(loan_amnt,term,int_rate,sub_grade,home_ownership,annual_inc,purpose, loan_status)
```
```{r}
glimpse(loans1)
```
```{r}
summary(loans1)
```


```{r}
loans2 <- loans1 %>%
  filter(!is.na(loan_amnt))
loans2

loans3 <- loans2 %>%
  filter(!is.na(annual_inc))

```
```{r}
glimpse(loans3)
```

#Visual and explore the characteristics of the defaults loans only to uderstand more about the type of loan that is written off.

```{r}
default1 <-loans3 %>%
  filter(loan_status == "Charged Off")
  
```
```{r}
glimpse(default1)
```
```{r}
summary(default1)
```

```{r}
default1 %>%
  summarise(term, term_count = n())

```
XX not working at all


```{r}
default1 %>%
  group_by(term, term_count = n())
```


```{r}
default_arranged <- default1 %>%
  select(loan_amnt, term)%>%
  arrange(desc(loan_amnt))
```

```{r}
ggplot(chick_weight) + 
  aes(x = time, y = weight, colour = diet) +
  geom_line(aes(group = chick), alpha = 0.25) +
  geom_point(alpha = 0.5) +
  geom_smooth()
```


```{r}
ggplot(default1) +
  geom_bar(aes(x= term), fill = "light blue")+
labs( x= "Term of Loan",
        y= "Number of Default Loans",
        title = "Lending Club Default Loans Data")
```
# Loans with the longer term of 60 months make up a higher percentage of the defaults loans ?? - so we could conclude that the longer the term the higher the exposure to changes in a persons financial status.


```{r}
ggplot(default1) +
  geom_bar(aes(x=home_ownership), fill = "light blue")+
   labs( x= "Houseing Status",
        y= "Number of Default Loans",
        title = "Lending Club Loans Data",
        subtitle = "Houseing Status")
```
#Default loans also have a higher percentage of renters - unsurprising and also might be considered a higher risk when lending


```{r}
ggplot(default1) +
  geom_bar(aes(x= term, fill = purpose))+
  labs( x= "Term of Default Loan",
        y= "Number of Default Loans",
        title = "Lending Club Default Loans Data",
        subtitle = "Term & Purpose",
        fill = "Purpose of Loan")
```
```{r}
ggplot(default1) + 
  aes(x = int_rate, y = term) +
  geom_point(aes(colour = sub_grade, shape = purpose), size = 4) +
  geom_text(
    aes(label = purpose),
    nudge_x = 0.5,
    nudge_y = 0.1,)
  
```

ggplot(pets) + 
  aes(x = age, y = weight) +
  geom_point(aes(colour = sex, shape = animal), size = 4) +
  geom_text(
    aes(label = name),
    nudge_x = 0.5,
    nudge_y = 0.1,)
  

```{r}
ggplot(default1) +
  geom_bar(aes(x= term, fill = annual_inc))+
  labs( x= "Term of Default Loan",
        y= "Number of Default Loans",
        title = "Lending Club Default Loans Data",
        subtitle = "Term & Purpose",
        fill = "Purpose of Loan")
```




```{r}
loansstatusnew <- loans3 %>%
  group_by(loan_status)
count(loansstatusnew)
```
#Total of 42,531 individual loan accounts with 5653 charged off (meaning that the lender has written off the debt and the account is closed) 
#(13% of the total loans made)

#Total of 33,586 fully paid (79% of the total loans)
#From the data set there are some records that are unclear catergories






```{r}
ggplot(loansstatusnew) +
  geom_bar(aes(x= loan_status), fill = "light blue")+
  coord_flip()+
labs( x= "Status of Loan",
        y= "Number of Loans",
        title = "Lending Club Loans Data",
        subtitle = "Status of Loan")
```





#loan status needs to be turned into a numerical column 0 or 1 for purpose of building a predictive model.

```{r}
loans3 %>%
  select(loan_status) %>%
  mutate(loan_status = recode(loan_status,"Fully Paid" = "1", "Charged Off" = "0", "Current" = "3")
  ) 
```


```{r}
loans4 <-loans3 %>%
  mutate(loan_status = recode(loan_status,"Fully Paid" = "1", "Charged Off" = "0", "Current" = "3")
  ) 
loans4
```

```{r}
head(loans4, 15)
```


```{r}
ggplot(loans4) +
  geom_bar(aes(x= term), fill = "light blue")+
labs( x= "Term of Loan",
        y= "Number of Loans",
        title = "Lending Club Loans Data")
```


```{r}
ggplot(loans4) +
  geom_bar(aes(x= loan_status), fill = "light blue")+
  coord_flip()+
labs( x= "Status of Loan",
        y= "Number of Loans",
        title = "Lending Club Loans Data")
```

```{r}
ggplot(loans4) +
  geom_bar(aes(x=home_ownership), fill = "light blue")+
   labs( x= "Houseing Status",
        y= "Number of Loans",
        title = "Lending Club Loans Data",
        subtitle = "Houseing Status")
```


```{r}
ggplot(loans4) +
  geom_bar(aes(x= term, fill = purpose))+
  labs( x= "Term of Loan",
        y= "Number of Loans",
        title = "Lending Club Loans Data",
        subtitle = "Term & Purpose",
        fill = "Purpose of Loan")
```
#More debt consolidation - so we could consdier that an application for such a matter could have a higher risk that for medical bills or buying a car.




#Machine Model



#Now let's have a look at the relationships with loan status. I will split the variables into three sets, as the output of `ggpairs()` will be slow and cramped if we include all variables at once. Note that a disadvantage of this approach is that it will be difficult to visually assess relationships between some predictor pairs if they fall into different split sets.


```{r}
loans_split1 <- loans4 %>%
  select(loan_amnt, term,home_ownership, loan_status)
```


```{r}
loans_split2 <- loans4 %>%
  select(annual_inc, purpose,loan_status)
```

#Now develop the connection with ggpairs

```{r}
library(GGally)
loans_split1 %>%
  ggpairs()
```

```{r}
library(GGally)
loans_split2 %>%
  ggpairs()
```









